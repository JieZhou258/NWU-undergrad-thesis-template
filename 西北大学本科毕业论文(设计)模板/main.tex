\documentclass[twoside,12pt,openright,AutoFakeBold]{ctexbook}

%======================= 宏包加载（正文相关） ===========================
\usepackage{wallpaper}     % 封面背景
\usepackage{amsmath,mathtools,amsthm,amsfonts,amssymb,bm}  % AMS 数学宏包
\usepackage{color}         % 支持颜色设置
\usepackage{fontspec}      % 字体设置（适用于 XeLaTeX）
\usepackage{setspace}      % 行距设置
\usepackage{indentfirst}   % 首段缩进
\setlength{\parindent}{2em}

%======================= 页面设置 ===========================
\usepackage{geometry}      % 页面边距设置
\geometry{
    a4paper,
    inner=45mm,
    outer=20mm,
    top=25mm,
    bottom=20mm, % 添加底部页边距
    %textheight=244mm,
    headheight=21.7mm
}

%======================= 页眉页脚设置 ===========================
\usepackage{fancyhdr}      % 自定义页眉页脚
\fancypagestyle{myfancy}{
    \fancyhf{}  % 清空原有设置
    \fancyfoot[CE,CO]{\thepage}
    \fancyhead[CE]{\songti\zihao{5}西北大学本科毕业论文（设计）}
    \fancyhead[CO]{\nouppercase{\leftmark}}
    \renewcommand{\headrule}{
        \makebox[0pt][l]{\rule[.7\baselineskip]{\headwidth}{3pt}}%
        \rule[.6\baselineskip]{\headwidth}{0.4pt}\vskip-.8\baselineskip
    }
}

%======================= 脚注设置 ===========================
\usepackage{pifont}        % 用于 \ding 圆圈数字
\usepackage{alphalph}      % 脚注编号扩展
\usepackage{chngcntr}      % 编号控制
\counterwithout{footnote}{chapter}  % 脚注全局编号
\newcommand{\circled}[1]{\ding{\numexpr171 + #1\relax}}
\renewcommand{\thefootnote}{\protect\circled{\value{footnote}}}

%======================= 标题格式设置 ===========================
\ctexset{
    chapter = {
        name = {},
        number = 第\Chinese{chapter}章,
        format += {\heiti\zihao{-2}\centering},
        beforeskip = 36pt,
        afterskip = 24pt,
        fixskip = true
    },
    section = {
        format += {\heiti\zihao{4}\raggedright},
        beforeskip = 18pt,
        afterskip = 18pt
    },
    subsection = {
        format += {\heiti\zihao{-4}\raggedright},
        beforeskip = 12pt,
        afterskip = 12pt
    }
}

%======================= 目录格式设置 ===========================
\usepackage{titletoc}
\renewcommand{\contentsname}{\heiti \zihao{-2}目\quad 录}

\titlecontents{chapter}[3em]
    {\vspace*{7pt}\heiti\zihao{4}}
    {\contentslabel{3.5em}}
    {\hspace*{-3.4em}}
    {~\titlerule*[0.6pc]{$.$}~\zihao{-4}\contentspage}

\titlecontents{section}[4em]
    {\songti\zihao{-4}}
    {\contentslabel{2em}}
    {\hspace*{-2em}}
    {~\titlerule*[0.6pc]{$.$}~\contentspage}

\titlecontents{subsection}[6em]
    {\songti\zihao{-4}}
    {\contentslabel{3em}}
    {\hspace*{-2em}}
    {~\titlerule*[0.6pc]{$.$}~\contentspage}

%======================= 参考文献设置 ===========================
\usepackage[
    backend=biber,
    style=gb7714-2015,
    sorting=none
]{biblatex}
\addbibresource{bib/ref.bib}

%======================= 定理环境定义 ===========================
\newtheoremstyle{mydefstyle}
  {1em}{1em}{}{}{\heiti \zihao{-4}}{.}{1em}{}
\theoremstyle{mydefstyle}

\newtheorem{definition}{\hskip 2em{定义}}[section]
\newtheorem{theorem}{\hskip 2em{定理}}[section]
\newtheorem{assumpation}[theorem]{\hskip 2em{假设}}
\newtheorem{lemma}[theorem]{\hskip 2em{引理}}
\newtheorem{corollary}[theorem]{\hskip 2em{推论}}
\newtheorem{example}{\hskip 2em{算例}}[chapter]
\newtheorem{remark}{\hskip 2em{注}}[chapter]
\renewcommand{\proofname}{\bf 证明}

%======================= 图表设置 ===========================
\usepackage{bicaption}
\captionsetup[figure][bi-second]{name=Fig}
\captionsetup[table][bi-second]{name=Table}

%======================= 数学符号与公式编号 ===========================
\renewcommand{\Re}{\operatorname{Re}}
\renewcommand{\Im}{\operatorname{Im}}
\newcommand{\mi}{\mathrm{i}}
\newcommand{\md}{\mathrm{d}}
\newcommand{\me}{\mathrm{e}}
\allowdisplaybreaks[4]
%\numberwithin{equation}{section} % 若需要按章节编号

%======================= 列表设置 ===========================
\usepackage[inline]{enumitem}
\setlist{
    topsep=0.3em,
    partopsep=0pt,
    itemsep=0ex plus 0.1ex,
    parsep=0pt,
    leftmargin=1.5em,
    rightmargin=0em,
    labelsep=0.5em,
    labelwidth=2em
}

%======================= 图像与表格 ===========================
\usepackage{graphicx,ragged2e}
\usepackage{subcaption}
\graphicspath{figure/}
\usepackage{longtable,booktabs}

%======================= 代码环境 ===========================
\usepackage{listings}
\renewcommand{\lstlistingname}{算法}
\lstset{
    keywordstyle=\bfseries,
    basicstyle=\ttfamily,
    commentstyle=\ttfamily,
    showstringspaces=false,
    breaklines=true,
    frame=single
}

%======================= 超链接设置 ===========================
\usepackage{hyperref}
\hypersetup{
    colorlinks=true,
    urlcolor=black,
    linkcolor=black,
    anchorcolor=black,
    citecolor=black
}

%======================= 插入 PDF ===========================
\usepackage[final]{pdfpages}

%======================= 正文开始 ===========================
\begin{document}

%========= 前置部分 =========
\frontmatter
\pagestyle{empty}
\include{tex/1_cover} %封面
\includepdf[pages={1}]{figure/Declaration.pdf} %诚信声明
\pagestyle{plain}
\pagenumbering{Roman}
\let\cleardoublepage\clearpage
\include{tex/3_abstract_cn} %中文摘要
\cleardoublepage
\include{tex/4_abstract_en} %英文摘要


%========= 目录部分 =========
\pagestyle{plain}
\setcounter{page}{1}
\pagenumbering{Roman}
\tableofcontents
\clearpage
\thispagestyle{plain}

%========= 正文部分 =========
\mainmatter
\fancypagestyle{plain}{\pagestyle{myfancy}}
\pagestyle{myfancy}
\include{tex/5_chapters} %正文章节

%========= 附录部分 =========
\backmatter

\include{tex/7_reference}
%\include{tex/8_Appendix}
\include{tex/9_thanks}

\end{document}
